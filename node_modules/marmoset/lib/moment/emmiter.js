"use strict";

Object.defineProperty(exports, "__esModule", {
    value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var _handlerSet = require("./handlerSet");

var _handlerSet2 = _interopRequireDefault(_handlerSet);

var _eventJs = require("./event.js");

var _eventJs2 = _interopRequireDefault(_eventJs);

var shadowClone = function shadowClone(obj) {
    var newObj = {};
    for (var name in obj) {
        newObj[name] = obj[name];
    }
    return newObj;
};

exports["default"] = function () {
    var handlerSetModel = (0, _handlerSet2["default"])();

    var response = function response(event) {
        var handlers = handlerSetModel.findHandlers(event.ctx, event.type);
        for (var i = 0; i < handlers.length; i++) {
            var elem = handlers[i];
            var clonedEvent = event.clone();
            elem(clonedEvent);

            // trick
            if (clonedEvent.isPropagationStopped()) {
                event.stopPropagation();
            }
        }
    };

    var trigger = function trigger(ctx, type, data) {
        var event = new _eventJs2["default"](ctx, type, data);
        response(event);
        return event;
    };
    return {
        on: handlerSetModel.addHandler,
        off: handlerSetModel.removeHandler,
        trigger: trigger
    };
};

module.exports = exports["default"];